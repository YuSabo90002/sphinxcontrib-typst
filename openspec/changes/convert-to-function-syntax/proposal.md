# Proposal: Convert to Function Syntax

## Why

ç¾åœ¨ã€typsphinxã¯ Typst sugar syntaxï¼ˆ`=`, `*`, `_`, `-`, `+`ï¼‰ã¨é–¢æ•°å‘¼ã³å‡ºã—æ§‹æ–‡ï¼ˆ`#heading()`, `#strong()`, `#emph()` ãªã©ï¼‰ã‚’æ··åœ¨ã•ã›ã¦ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

ã“ã®ä¸çµ±ä¸€ã«ã‚ˆã‚Šä»¥ä¸‹ã®å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ï¼š

1. **ä¿å®ˆæ€§ã®ä½ä¸‹**: Sugar syntax ã¨é–¢æ•°å‘¼ã³å‡ºã—ãŒæ··åœ¨ã—ã€ã‚³ãƒ¼ãƒ‰æ§‹é€ ãŒä¸æ˜ç­
2. **æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã®ãƒªã‚¹ã‚¯**: `*_text_*` ã®ã‚ˆã†ãª sugar syntax ã®çµ„ã¿åˆã‚ã›ã§ Typst ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿï¼ˆIssue #55 ã§ç¢ºèªæ¸ˆã¿ï¼‰
3. **1:1å¯¾å¿œã®æ¬ å¦‚**: `visit_*/depart_*` ãƒ¡ã‚½ãƒƒãƒ‰ã¨ Typst é–¢æ•°ã®å¯¾å¿œãŒä¸æ˜ç¢º
4. **ä¸€è²«æ€§ã®æ¬ å¦‚**: ä¸€éƒ¨ã®è¦ç´ ï¼ˆ`#sub[]`, `#super[]`, `#quote[]` ãªã©ï¼‰ã¯æ—¢ã«é–¢æ•°æ§‹æ–‡ã‚’ä½¿ç”¨

**å…·ä½“çš„ãªå•é¡Œä¾‹**ï¼ˆå‰å›ã®å®Ÿè£…ã§ç¢ºèªï¼‰:
```typst
*_templates/custom_ieee.typ*:
```
ã“ã®ã‚ˆã†ãª sugar syntax ã®çµ„ã¿åˆã‚ã›ãŒ "unclosed delimiter" ã‚¨ãƒ©ãƒ¼ã‚’å¼•ãèµ·ã“ã—ã¾ã™ã€‚

## What Changes

### å¤‰æ›å¯¾è±¡è¦ç´ 

ä»¥ä¸‹ã®6è¦ç´ ã‚’ sugar syntax ã‹ã‚‰é–¢æ•°å‘¼ã³å‡ºã—æ§‹æ–‡ã«å¤‰æ›ã—ã¾ã™ï¼š

| Element | Current Syntax | Target Syntax | å½±éŸ¿ç¯„å›² |
|---------|---------------|---------------|---------|
| Heading | `= Heading` | `#heading(level: 1)[Heading]` | translator.py:123-142 |
| Emphasis | `_text_` | `#emph[text]` | translator.py:328-345 |
| Strong | `*text*` | `#strong[text]` | translator.py:347-364 |
| Subtitle | `_subtitle_` | `#emph[subtitle]` | translator.py:144-161 |
| Bullet List | `- item` | `#list([item])` | translator.py:423-476 |
| Enum List | `+ item` | `#enum([item])` | translator.py:442-476 |

### å¤‰æ›´ã—ãªã„è¦ç´ 

ä»¥ä¸‹ã¯å¤‰æ›´å¯¾è±¡å¤–ã§ã™ï¼š

- âœ… **Code blocks / Inline code** (`` `code` ``, ` ```lang `)
  - Typstæ¨™æº–æ§‹æ–‡ã§ã‚ã‚Šã€sugar syntax ã§ã¯ãªã„
- âœ… **Definition lists** (`/ term: definition`)
  - æ—¢ã« Typst æ¨™æº–ã® term list æ§‹æ–‡ã‚’ä½¿ç”¨
- âœ… **æ—¢ã«é–¢æ•°æ§‹æ–‡ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹è¦ç´ **
  - `#sub[]`, `#super[]`, `#quote[]`, `#image()`, `#table()`, `#figure()`, `#link()`, admonitions ãªã©

### å®Ÿè£…æ–¹é‡

1. **æ®µéšçš„å¤‰æ›**: è¦ç´ ã”ã¨ã«å¤‰æ›ã—ã€å„ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ†ã‚¹ãƒˆ
2. **ãƒ†ã‚¹ãƒˆæ›´æ–°**: ã™ã¹ã¦ã®æœŸå¾…å€¤ã‚’æ–°ã—ã„æ§‹æ–‡ã«æ›´æ–°
3. **å¾Œæ–¹äº’æ›æ€§**: ç”Ÿæˆã•ã‚Œã‚‹ PDF å‡ºåŠ›ã¯åŒä¸€ï¼ˆæ§‹æ–‡ã®ã¿å¤‰æ›´ï¼‰

## Impact

### Affected Specs

å¤‰æ›´ãŒå¿…è¦ãªä»•æ§˜ï¼š
- `document-conversion`: å„è¦ç´ ã®å‡ºåŠ›æ§‹æ–‡ã‚’æ›´æ–°

### Affected Code

**å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«**:
- `typsphinx/translator.py`: 6è¦ç´ ã® `visit_*/depart_*` ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆç´„12ãƒ¡ã‚½ãƒƒãƒ‰ï¼‰
- `tests/test_translator.py`: ã™ã¹ã¦ã®æœŸå¾…å€¤æ›´æ–°
- ãã®ä»–ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: çµ±åˆãƒ†ã‚¹ãƒˆã€E2Eãƒ†ã‚¹ãƒˆã®æœŸå¾…å€¤æ›´æ–°

**å½±éŸ¿ã‚’å—ã‘ã‚‹ãƒ†ã‚¹ãƒˆ**: ç´„50-100ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼ˆæœŸå¾…å€¤ã®ã¿æ›´æ–°ï¼‰

### Breaking Changes

âš ï¸ **Breaking Change**: ç”Ÿæˆã•ã‚Œã‚‹ `.typ` ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãŒå¤‰æ›´ã•ã‚Œã¾ã™

**å½±éŸ¿ç¯„å›²**:
- æ—¢å­˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å†ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã€`.typ` ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ãŒå¤‰ã‚ã‚‹
- ãŸã ã—ã€æœ€çµ‚çš„ãªPDFå‡ºåŠ›ã¯åŒä¸€

**ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**:
- Major version bump ãŒå¿…è¦ï¼ˆv0.2.0 â†’ v0.3.0 ã¾ãŸã¯ v1.0.0ï¼‰

### User-Visible Changes

**å¤‰æ›´å‰**:
```typst
= Introduction

This is _emphasized_ and *strong* text.

- First item
- Second item

+ Numbered 1
+ Numbered 2
```

**å¤‰æ›´å¾Œ**:
```typst
#heading(level: 1)[Introduction]

This is #emph[emphasized] and #strong[strong] text.

#list(
  [First item],
  [Second item],
)

#enum(
  [Numbered 1],
  [Numbered 2],
)
```

## Alternatives Considered

### 1. Sugar syntax ã‚’ç¶­æŒã™ã‚‹ï¼ˆç¾çŠ¶ç¶­æŒï¼‰

**å´ä¸‹ç†ç”±**:
- æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã®ãƒªã‚¹ã‚¯ãŒæ®‹ã‚‹
- ã‚³ãƒ¼ãƒ‰ã®ä¿å®ˆæ€§ãŒä½ã„ã¾ã¾
- ä¸çµ±ä¸€ãŒç¶™ç¶š

### 2. éƒ¨åˆ†çš„ã«å¤‰æ›ï¼ˆä¸€éƒ¨ã®è¦ç´ ã®ã¿ï¼‰

**å´ä¸‹ç†ç”±**:
- å•é¡Œã¯è§£æ±ºã—ãªã„
- ã•ã‚‰ãªã‚‹ä¸çµ±ä¸€ã‚’ç”Ÿã‚€

### 3. ã™ã¹ã¦ã®è¦ç´ ã‚’é–¢æ•°æ§‹æ–‡ã«çµ±ä¸€ï¼ˆé¸æŠï¼‰

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ… æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ã®ãƒªã‚¹ã‚¯è§£æ¶ˆ
- âœ… ã‚³ãƒ¼ãƒ‰æ§‹é€ ã®æ˜ç¢ºåŒ–
- âœ… ä¸€è²«æ€§ã®ç¢ºä¿
- âœ… ä¿å®ˆæ€§ã®å‘ä¸Š

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âš ï¸ Breaking change
- ğŸ”§ ãƒ†ã‚¹ãƒˆã®å¤§é‡æ›´æ–°ãŒå¿…è¦

## Implementation Notes

### Heading å®Ÿè£…ã®æ³¨æ„ç‚¹

```python
# Before
def visit_title(self, node):
    heading_prefix = "=" * self.section_level
    self.add_text(f"{heading_prefix} ")

# After
def visit_title(self, node):
    self.add_text(f"#heading(level: {self.section_level})[")

def depart_title(self, node):
    self.add_text("]\n\n")
```

### List å®Ÿè£…ã®æ³¨æ„ç‚¹

ãƒªã‚¹ãƒˆã¯ãƒã‚¹ãƒˆã«å¯¾å¿œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```python
# ãƒã‚¹ãƒˆã•ã‚ŒãŸãƒªã‚¹ãƒˆã®ä¾‹
#list(
  [First item],
  [Second item with nested:
    #list(
      [Nested 1],
      [Nested 2],
    )
  ],
)
```

å®Ÿè£…ã§ã¯ï¼š
1. ãƒªã‚¹ãƒˆé …ç›®ã‚’åé›†
2. ãƒªã‚¹ãƒˆçµ‚äº†æ™‚ã« `#list()` / `#enum()` ã¨ã—ã¦å‡ºåŠ›
3. ãƒã‚¹ãƒˆãƒ¬ãƒ™ãƒ«ã‚’é©åˆ‡ã«ç®¡ç†

### ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

1. **å˜ä½“ãƒ†ã‚¹ãƒˆ**: å„è¦ç´ ã®å¤‰æ›ãƒ†ã‚¹ãƒˆ
2. **çµ±åˆãƒ†ã‚¹ãƒˆ**: ãƒã‚¹ãƒˆã•ã‚ŒãŸæ§‹é€ ã®ãƒ†ã‚¹ãƒˆ
3. **å›å¸°ãƒ†ã‚¹ãƒˆ**: æ—¢å­˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®PDFå‡ºåŠ›ãŒåŒä¸€ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

### ç§»è¡Œã‚¬ã‚¤ãƒ‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
- Breaking change ã®èª¬æ˜
- ç”Ÿæˆã•ã‚Œã‚‹ `.typ` ãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´å†…å®¹
- PDFå‡ºåŠ›ã¯åŒä¸€ã§ã‚ã‚‹ã“ã¨ã®ä¿è¨¼
